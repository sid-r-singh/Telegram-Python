name: Python TG update
on:
  workflow_dispatch:
    inputs:
      no_trials:
        description: No. of trials for Monte Carlo program
        default: 1000
        required: true
      user_chat_id:
        description: Chat ID of TG user
        default: 10 digit ID
        required: true
env:
  INPUT_NO_TRIALS: ${{ github.event.inputs.no_trials }}

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Send intitial update over Tg
        run: |
          curl -X POST \
          -H 'Content-Type: application/json' \
          -d '{"chat_id": ${{ secrets.TG_BOT_CHAT_ID }}, "text": "GH runner: ⏳ Starting Monte Calro program with ${{ github.event.inputs.no_trials }} trials"}' \
          https://api.telegram.org/bot${{ secrets.TG_BOT_TOKEN }}/sendMessage
      - name: Checkout main branch
        uses: actions/checkout@v2
      - name: Setup Python Environment
        uses: actions/setup-python@v2
        with:
          python-version: 3.7
      - name: Install Requirements
        run: pip install -r requirements.txt
      - name: Execute Python script
        run: |
          python main.py
      - name: Send final updates over TG
        run: |
          curl -X POST \
          -H 'Content-Type: application/json' \
          -d '{"chat_id": ${{ secrets.TG_BOT_CHAT_ID }}, "text": "GH runner: ⌛️Finished Monte Calro program with ${{ github.event.inputs.no_trials }} trials"}' \
          https://api.telegram.org/bot${{ secrets.TG_BOT_TOKEN }}/sendMessage
          curl -F document=@"plot.png" https://api.telegram.org/bot${{ secrets.TG_BOT_TOKEN }}/sendDocument?chat_id=${{ secrets.TG_BOT_CHAT_ID }}
